# üìã SESI√ìN 31/12/2025 - ParsearFacturas

## üéØ RESUMEN

| M√©trica | Valor |
|---------|-------|
| **Extractores nuevos** | 1 (LAVAPIES) |
| **Extractores mejorados** | 2 (BODEGAS MU√ëOZ, LOS GREDALES) |
| **Facturas verificadas** | 13 LAVAPIES + 4 MU√ëOZ + 5 GREDALES = 22 |
| **Tasa de √©xito** | 100% en los 3 proveedores |

---

## ‚úÖ EXTRACTORES TRABAJADOS

### 1. DISTRIBUCIONES LAVAPIES (NUEVO)
| Campo | Valor |
|-------|-------|
| **CIF** | F88424072 |
| **IBAN** | ES39 3035 0376 14 3760011213 |
| **Facturas** | 13/13 ‚úÖ |
| **Archivo** | `lavapies.py` |

**Caracter√≠sticas especiales:**
- ‚ö†Ô∏è **Proveedor con errores frecuentes de IVA**
- IVA deducido de las bases de la factura (no hardcodeado)
- Algoritmo subset-sum para determinar qu√© productos van a cada tipo de IVA
- Genera avisos cuando el IVA de factura no coincide con el diccionario esperado
- 32 avisos de discrepancia IVA detectados en 13 facturas

**Productos manejados:**
| REF | Producto | IVA esperado |
|-----|----------|--------------|
| AGUVIC | AGUA VICHY CATALAN | 10% |
| ZULINMA/PE/TO | ZUMOS LINDA | 10% |
| REFSIFG/SIFT | SIFONES | 10% |
| ZUMMOG1 | MOSTO GREIP | 21% |
| REFCAS1 | GASEOSA CASERA | 21% |
| REFREV2 | REVOLTOSA LIMON | 21% |
| REFFRIX | FRIXEN COLA | 21% |
| PALESZE/CO | PALESTINA | 21% |
| SCHT15 | SCHWEPPES T√ìNICA | 21% |
| REFSEV | SEVEN UP | 21% |

---

### 2. BODEGAS MU√ëOZ MARTIN (MEJORADO)
| Campo | Valor |
|-------|-------|
| **CIF** | E83182683 |
| **IBAN** | ES62 0049 5184 11 2016002766 |
| **Facturas** | 4/4 ‚úÖ |
| **Archivo** | `bodegas_munoz.py` |

**Caracter√≠sticas especiales:**
- Soporte dual: pdfplumber + OCR (Tesseract)
- Facturas escaneadas procesadas con OCR
- Filtros para evitar capturar cuadro fiscal en OCR
- Productos: VINO TEMPRANILLO (R CAJA 6 BOT. VI√ëA JESUSA) + PORTES

---

### 3. LOS GREDALES (MEJORADO)
| Campo | Valor |
|-------|-------|
| **CIF** | B83594150 |
| **IBAN** | ES82 2103 7178 2800 3001 2932 |
| **Facturas** | 5/5 ‚úÖ |
| **Archivo** | `gredales.py` |

**Caracter√≠sticas especiales:**
- Extrae l√≠neas individuales con categor√≠as del diccionario
- Validaci√≥n contra BASE IMPONIBLE de la factura
- Fallback a l√≠nea √∫nica si hay inconsistencia proveedor
- 5 tipos de vino: SAUVIGNON BLANC, SYRAH, CABERNET, GARNACHA ROS√â, GRACIANO

---

## üì¶ ARCHIVOS GENERADOS

| Archivo | Descripci√≥n | Estado |
|---------|-------------|--------|
| `lavapies.py` | Extractor DISTRIBUCIONES LAVAPIES | **PENDIENTE INTEGRAR** |
| `bodegas_munoz.py` | Extractor BODEGAS MU√ëOZ MARTIN | Ya integrado |
| `gredales.py` | Extractor LOS GREDALES mejorado | Ya integrado |

---

## üîß T√âCNICAS APLICADAS

1. **Deducci√≥n de IVA por subset-sum** - Para proveedores con IVA variable/errores
2. **Sistema de avisos** - Alerta cuando IVA factura ‚â† IVA esperado
3. **OCR con filtros** - Evitar capturar cuadro fiscal
4. **Validaci√≥n BASE IMPONIBLE** - Fallback si l√≠neas no cuadran

---

## üìã CHECKLIST DESPLIEGUE

```cmd
# 1. Copiar extractor nuevo
copy lavapies.py C:\_ARCHIVOS\TRABAJO\Facturas\ParsearFacturas-main\extractores\

# 2. Limpiar cach√©
cd C:\_ARCHIVOS\TRABAJO\Facturas\ParsearFacturas-main\extractores
rmdir /s /q __pycache__

# 3. Verificar registro
python -c "from extractores.lavapies import ExtractorLavapies; print('OK:', ExtractorLavapies.nombre)"

# 4. Commit
git add .
git commit -m "Sesi√≥n 31/12: +LAVAPIES (IVA deducido de factura)"
git push
```

---

## üéØ PR√ìXIMA SESI√ìN - PRIORIDADES

### Quick wins pendientes (DESCUADRES)
| Proveedor | Errores | Dificultad |
|-----------|---------|------------|
| BM SUPERMERCADOS | 37 | üü° Media |
| FELISA GOURMET | 12 | üü¢ F√°cil |
| JAMONES BERNAL | 6 | üü° Media |
| SILVA CORDERO | 5 | üü° Media |

### OCR pendientes
| Proveedor | Errores | Dificultad |
|-----------|---------|------------|
| JIMELUZ | 19 | üî¥ Alta |
| LA ROSQUILLERIA | 10 | üî¥ Alta |

---

*Sesi√≥n cerrada: 31/12/2025*
*Feliz A√±o Nuevo üéâ*
